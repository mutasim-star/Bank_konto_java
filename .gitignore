package kontostand;

import java.util.InputMismatchException;
import java.util.Scanner;



public class Bank {
	
	
	
	 private static Konto[] konten = new Konto[100];
	    private static int anzahlkonten = 0;
	    private static Scanner sc = new Scanner(System.in);
	    
	    // nachstekundenNr;= einen Datentyp wo 1000 gespeichert wird
	    private static int nachstekundenNr = 1000; 
    
	public static void main(String[] args) {
	
		 boolean programmlauft = true;

	        while (programmlauft) {
	            menu(); 
	            System.out.print("Ihre Auswahl: ");
	            int auswahl = 0;

	            try {
	                auswahl = sc.nextInt();
	                sc.nextLine(); 
	            } catch (InputMismatchException e) {
	                System.out.println(">> Ungültige Eingabe! Bitte eine Zahl eingeben.");
	                sc.nextLine(); 
	                continue; 
	            }

	            System.out.println();

	            if (auswahl == 1) {
	                kontoeroeffnen();
	            } else if (auswahl == 2) {
	                einzahlen();
	            } else if (auswahl == 3) {
	                abheben();
	            } else if (auswahl == 4) {
	                ueberweisen();
	            } else if (auswahl == 5) {
	                historieAnzeigen();
	            } else if (auswahl == 6) {
	                System.out.println("Programm wird beendet. Auf Wiedersehen!");
	                programmlauft = false;
	            } else {
	                System.out.println(">> Ungültige Auswahl. Bitte wählen Sie 1-6.");
	            }
	            System.out.println(); 
	        }
	        sc.close();
	    }

	    public static void menu() {
	        String[] menue = {
	            "=== BANK-MENÜ ===",
	            "1. Konto eröffnen",
	            "2. Einzahlen",
	            "3. Abheben",
	            "4. Überweisen",
	            "5. Konto-Historie anzeigen",
	            "6. Programm beenden"
	        };
	        
	        // NEU: Die for-each-Schleife
	        // Für jeden String (den wir 'zeile' nennen) im Array 'menü':
	        for (String zeile : menue) {
	            // gib diesen String aus
	            System.out.println(zeile);
	        }
	    }

	    // ============================================================
	    //   HILFSMETHODEN (WERKZEUGE)
	    // ============================================================

	    // 1. DIE "GESPRÄCHIGE" METHODE (UI)
	    // Diese Methode fragt den Benutzer nach einer Kontonummer.
	    // Sie nutzt den Scanner (sc), um die Eingabe zu lesen.
	    // Danach ruft sie die "Stille" Methode (sucheKontoImArray) auf, um das Konto zu finden.
	    public static Konto findeKontoDialog() {
	        System.out.print("Bitte Kontonummer eingeben: ");
	        String gesuchteNr = sc.nextLine();
	        
	        // Hier nutzen wir den "Archivar" (die untere Methode), um die Arbeit zu machen
	        Konto gefundenesKonto = sucheKontoImArray(gesuchteNr);
	        
	        if (gefundenesKonto == null) {
	            System.out.println(">> Fehler: Kein Konto mit Nummer " + gesuchteNr + " gefunden.");
	        }
	        
	        return gefundenesKonto;
	    }

	    // 2. DIE "STILLE" METHODE (LOGIK) 
	    // Diese Methode sucht ein Konto im Array 'konten' basierend auf der übergebenen Nummer.
	    // Sie gibt das gefundene Konto-Objekt zurück oder 'null', wenn nichts gefunden wurde.
	    private static Konto sucheKontoImArray(String nummer) {
	        // MANUELLE SUCHE (Folie 91: for-Schleife)
	        // Wir gehen durch alle bereits erstellten Konten (bis anzahlkonten).
	        for (int i = 0; i < anzahlkonten; i++) {
	            
	            // 1. Konto aus dem Array holen
	            Konto aktuellesKonto = konten[i];
	            
	            // 2. Prüfen: Ist das die gesuchte Nummer?
	            // getKontonummer() ist eine Methode aus der Klasse Konto!
	            // .equals() vergleicht den Textinhalt (Folie 131).
	            if (aktuellesKonto.getKontonummer().equals(nummer)) {
	                return aktuellesKonto; // Gefunden! Sofort zurückgeben.
	            }
	        }
	        return null; // Nichts gefunden
	    }

	    // Diese Methode liest eine Kommazahl (double) sicher ein.
	    // Sie fängt Fehler ab, falls der Benutzer Buchstaben statt Zahlen eingibt.
	    private static double liesDouble() {
	        try {
	            // Versuche, eine Kommazahl zu lesen
	            double wert = sc.nextDouble();
	            // WICHTIG: Lösche den Zeilenumbruch (Enter) aus dem Speicher,
	            // damit die nächste Eingabe (z.B. Name) nicht übersprungen wird.
	            sc.nextLine(); 
	            return wert;
	        } catch (InputMismatchException e) {
	            // Falls keine Zahl eingegeben wurde (z.B. "abc"):
	            System.out.println(">> Ungültige Zahl. Verwende 0.0");
	            // Lösche die falsche Eingabe aus dem Speicher, damit es weitergehen kann.
	            sc.nextLine(); 
	            return 0.0;
	        }
	    }
	    //   HAUPTFUNKTIONEN
	  
	    private static void kontoeroeffnen() {
	        if (anzahlkonten >= konten.length) {
	            System.out.println("FEHLER: Die Bank ist leider Voll ");
	            return;
	        }
	        
	        System.out.print("Bitte name des Inhabers eingeben: ");
	        String name = sc.nextLine();
	        
	        /* nicht als int, weil hier geht es um einen typ(int) und 
	         * nummer(int), speichern wir das in einem string umwandung von int(1000) zu nummer(nummer)
	         */
	        String nummer = "" + nachstekundenNr;
	        
	        nachstekundenNr++; //++ damit der nächste kunde eine andere nummer bekommt
	        
	        //erstelle eine neus Kontoobjekt (konto klasse)
	        Konto neuskonto = new Konto(nummer, name);
	        
	        konten[anzahlkonten] = neuskonto;
	        
	        // Erhöhe den Zähler um Eins, damit das nächste Konto im nächsten freien Fach landet
	        anzahlkonten++;
	        
	        System.out.println("Konto erfolgreich eröffnet!");
	        System.out.println("Kontonummer: " + nummer + " | Inhaber: " + name);
	    }

	    private static void einzahlen() {
	        Konto k = findeKontoDialog();
	        if (k != null) {
	            System.out.print("Betrag zum Einzahlen: ");
	            double betrag = liesDouble();
	            
	            // einzahlen() ist eine Methode aus der Klasse Konto!
	            k.einzahlen(betrag); 
	        }
	    }

	    private static void abheben() {
	        Konto k = findeKontoDialog();
	        if (k != null) {
	            System.out.print("Betrag zum Abheben: ");
	            double betrag = liesDouble();
	            
	            // abheben() ist eine Methode aus der Klasse Konto!
	            k.abheben(betrag);
	        }
	    }

	    private static void ueberweisen() {
	        System.out.println("--- Schritt 1: Sender wählen ---");
	        Konto sender = findeKontoDialog(); // Nutzt den Dialog ("Bitte Kontonummer...")
	        if (sender == null) return;

	        System.out.println("--- Schritt 2: Empfänger wählen ---");
	        System.out.print("Ziel-Kontonummer eingeben: "); // Eigener Text!
	        String zielNr = sc.nextLine();
	        
	        // HIER nutzen wir jetzt den "Stillen Archivar" (sucheKontoImArray)
	        // Wir wollen nicht nochmal "Bitte Kontonummer eingeben" vom Dialog haben.
	        Konto empfaenger = sucheKontoImArray(zielNr);

	        if (empfaenger == null) {
	            System.out.println(">> Fehler: Empfänger-Konto nicht gefunden.");
	            return;
	        }

	        System.out.print("Betrag überweisen: ");
	        double betrag = liesDouble();
	        
	        // ueberweisen() ist eine Methode aus der Klasse Konto!
	        sender.ueberweisen(empfaenger, betrag);
	    }

	    private static void historieAnzeigen() {
	        // 1. Welches Konto? (Dialog mit dem Nutzer)
	        Konto k = findeKontoDialog();
	        
	        // 2. Sicherheitscheck: Haben wir eines gefunden?
	        if (k != null) {
	            // 3. DELEGATION: Die Bank sagt dem Konto: "Zeig DU bitte deine Historie an."
	            // (Die Bank darf nicht direkt auf das private Array zugreifen)
	            
	            // zeigeHistorie() ist eine Methode aus der Klasse Konto!
	            k.zeigeHistorie();
	        }
	    }
